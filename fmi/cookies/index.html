<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>–°–µ—Å–∏–∏</title>

		<link rel="stylesheet" href="../../dist/reset.css">
		<link rel="stylesheet" href="../../dist/reveal.css">
		<link rel="stylesheet" href="../../dist/theme/white.css" id="theme">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="../../plugin/highlight/monokai.css" id="highlight-theme">

		<style>
			.flow {
				width: 100%;
				background: #fff;
				padding: 5px;
				border-radius: 10px;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			}
			.step {
				margin-bottom: 5px;
			}
			.arrow {
				text-align: center;
				font-size: 22px;
				margin: 5px 0;
			}
			.token {
				background: #eef;
				padding: 5px;
				border-left: 4px solid #88f;
				margin-top: 5px;
			}
		</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h3>–°–µ—Å–∏–∏</h3>
				</section>

				<section>
					<figure>
						<img src="images/pict--sales-flowchart-hunting-and-fishing-license-sales-flowchart.png"/>
					</figure>
				</section>

				<section>
					<h3>HTTP –ø—Ä–æ—Ç–æ–∫–æ–ª</h3>
					<ul>
						<li class="fragment fade-in">Stateless –ø—Ä–æ—Ç–æ–∫–æ–ª.</li>
						<li class="fragment fade-in">–ó–∞—è–≤–∫–∏—Ç–µ —Å–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–∏ –ø–æ–º–µ–∂–¥—É —Å–∏.</li>
						<li class="fragment fade-in">–ù–µ –º–æ–≥–∞—Ç –¥–∞ —Å–µ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞—Ç —Å–≤—ä—Ä–∑–∞–Ω–∏ –∑–∞—è–≤–∫–∏.</li>
						<li class="fragment fade-in">–ö–∞–∫ —Å–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏—Ç–µ?</li>
					</ul>
				</section>

				<section>
					<h3>–°–µ—Å–∏—è</h3>
					<section>
						<div class="flow">
							<div class="step">üßë‚Äçüíª <strong>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</strong> ‚Üí <strong>Login</strong> ‚Üí üñ•Ô∏è <strong>–°—ä—Ä–≤—ä—Ä</strong></div>
						
							<div class="step">üñ•Ô∏è <strong>–°—ä—Ä–≤—ä—Ä</strong> ‚Üí –°—ä–∑–¥–∞–≤–∞ <em>—Å–µ—Å–∏—è</em></div>
							<div class="step">üñ•Ô∏è <strong>–°—ä—Ä–≤—ä—Ä</strong> ‚Üí –ò–∑–ø—Ä–∞—â–∞ <strong>–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä</strong> –Ω–∞ —Å–µ—Å–∏—è ‚Üí üåê <strong>–ë—Ä–∞—É–∑—ä—Ä</strong></div>
						
							<div class="step">üåê <strong>–ë—Ä–∞—É–∑—ä—Ä</strong> ‚Üí –ò–∑–ø—Ä–∞—â–∞ <strong>–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä</strong> –Ω–∞ —Å–µ—Å–∏—è ‚Üí üñ•Ô∏è <strong>–°—ä—Ä–≤—ä—Ä</strong></div>
							<div class="step">üñ•Ô∏è <strong>–°—ä—Ä–≤—ä—Ä</strong> ‚Üí –ò–∑–ø–æ–ª–∑–≤–∞ <strong>–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä</strong> –Ω–∞ —Å–µ—Å–∏—è</div>
						</div>
					</section>
					<section>
						<ul>
							<li class="fragment fade-in">–ü–æ—Ä–µ–¥–∏—Ü–∞ –æ—Ç –Ω–µ–ø—Ä–µ–∫—ä—Å–Ω–∞—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª –Ω–∞ –¥–∞–¥–µ–Ω–æ —É–µ–± –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–∞–º–∫–∏—Ç–µ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–µ—Ä–∏–æ–¥ –æ—Ç –≤—Ä–µ–º–µ.</li>
							<li class="fragment fade-in">–î–∞–Ω–Ω–∏—Ç–µ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞—Ç –ø–æ–¥ —Ñ–æ—Ä–º–∞—Ç–∞ –Ω–∞ –Ω–∞—Ä–µ–¥–µ–Ω–∏ –¥–≤–æ–π–∫–∏ –∫–ª—é—á - —Å—Ç–æ–π–Ω–æ—Å—Ç.</li>
						</ul>
					</section>
					<section>
						<figure>
							<img src="images/List of Sessions 2.png"/>
						</figure>
					</section>
				</section>

				<section>
					<h3>–ö—ä–¥–µ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞—Ç —Å–µ—Å–∏–∏—Ç–µ?</h3>
					<section>
						<ul>
							<li class="fragment fade-in">–≤ –±–∏—Å–∫–≤–∏—Ç–∫–∏ –≤ –±—Ä–∞—É–∑—ä—Ä–∞ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è</li>
							<li class="fragment fade-in">–≤ localStorage</li>
							<li class="fragment fade-in">–≤ sessionStorage</li>
						</ul>
					</section>

					<section>
						<figure>
							<img src="images/sesstion-stores.png"/>
						</figure>
					</section>
				</section>

				<!-- <section style="left: -340px; width: 100%;">
					<table>
						<tr>
							<th>–•—Ä–∞–Ω–∏–ª–∏—â–µ</th>
							<th>–ë—ä—Ä–∑–∏–Ω–∞</th>
							<th>–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç</th>
							<th>–ú–∞—â–∞–±–∏—Ä—É–µ–º–æ—Å—Ç</th>
							<th>–ü–æ–¥—Ö–æ–¥—è—â–æ –∑–∞</th>
						</tr>
						<tr>
							<td>–ü–∞–º–µ—Ç—Ç–∞ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ</td>
							<td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
							<td>‚ùå</td>
							<td>‚ùå</td>
							<td>Development</td>
						</tr>
						<tr>
							<td>SQL DB</td>
							<td>‚≠ê‚≠ê</td>
							<td>‚úÖ‚úÖ</td>
							<td>‚úÖ</td>
							<td>Legacy/Analytics</td>
						</tr>
						<tr>
							<td>MongoDB</td>
							<td>‚≠ê‚≠ê‚≠ê</td>
							<td>‚úÖ‚úÖ</td>
							<td>‚úÖ</td>
							<td>ME(N) stack apps</td>
						</tr>
						<tr>
							<td>Redis / Memcached</td>
							<td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
							<td>‚úÖ‚úÖ‚úÖ</td>
							<td>‚úÖ‚úÖ‚úÖ</td>
							<td>Production</td>
						</tr>
					</table>
				</section> -->

				<section>
					<h3>–°—ä—Ö—Ä–∞–Ω—è–≤–∞–Ω–µ –Ω–∞ —Å–µ—Å–∏—è –≤ –∫–µ—à–∞</h3>
					<section>
						<figure>
							<img src="images/1_DdKCmZ4CTdYzGKtk6YpWzQ.png"/>
						</figure>
					</section>
					
					<section>
						<h4>–ü—Ä–µ–¥–∏–º—Å—Ç–≤–∞</h4>
						<ul>
							<li class="fragment fade-in">–±—ä—Ä–∑–æ –∏–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏</li>
							<li class="fragment fade-in">–ø–æ-–º–∞–ª–∫–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</li>
							<li class="fragment fade-in">–º–æ–∂–µ –¥–∞ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∑–∞ –Ω—è–∫–æ–ª–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</li>
							<li class="fragment fade-in">—É–ø—Ä–∞–≤–ª—è–≤–∞ —Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</li>
						</ul>
					</section>
					<section>
						<h4>–ù–µ–¥–æ—Å—Ç–∞—Ç—ä—Ü–∏</h4>
						<ul>
							<li class="fragment fade-in">–¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–µ–Ω —Ä–µ—Å—É—Ä—Å</li>
							<li class="fragment fade-in">–Ω–µ –µ –ø–æ–¥—Ö–æ–¥—è—â–æ –∑–∞ –º–∞–ª–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</li>
							<li class="fragment fade-in">–Ω—É–ª–∏—Ä–∞–Ω–µ –Ω–∞ –∫–µ—à–∞ => —É–Ω–∏—â–æ–∂–∞–≤–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ —Å–µ—Å–∏–∏</li>
						</ul>
					</section>
				</section>

				<section>
					<h3>–°–µ—Å–∏–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∞ Express</h3>

					<section>
						<figure>
							<img src="images/1_D4RORzEcl9Snzhr6JXeB4A.png"/>
						</figure>
					</section>

					<section>
						<h4>–ö–∞–∫ –¥–∞ —Å—ä–∑–¥–∞–¥–µ–º —Å–µ—Å–∏—è —Å Express?</h4>
						<pre class="highlight js">
							<code data-line-numbers="4|5|6|9|10|12|13-15|16|17-20">
import * as express from 'express';
import * as uuid from 'uuid/v4';
import * as session from 'express-session';
import * as Memcached from 'memcached';
import * as memcached from 'connect-memcached';

const app = express();
const memcachedServer = new Memcached(`${MEMCACHED_HOST}:${MEMCACHED_PORT}`);
const MemcachedStore = memcached(session);

app.use(session({
	genid: (req) => {
		return uuid.v4().toString();
	},
	secret: SESSION_SECRET_KEY,
	store   : new MemcachedStore({
		hosts: [`${MEMCACHED_HOST}:${MEMCACHED_PORT}`], 
		secret: MEMCACHED_SECRET_KEY
	})
}));							
							</code>
						</pre>
					</section>

					<section>
						<h4>–ö–∞–∫ –¥–∞ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞–º–µ –¥–∞–Ω–Ω–∏ –≤ —Å–µ—Å–∏—è —Å Express?</h4>
						<pre class="highlight js">
							<code data-line-numbers="3,4">
app.get('/', function(req, res, next) {
	let sessData = req.session;
	sessData.someAttribute = "foo";
	res.send('Returning with some text');
});															   
							</code>
						</pre>
					</section>

					<section>
						<h4>–ö–∞–∫ –¥–∞ –∏–∑–≤–ª–∏—á–∞–º–µ –¥–∞–Ω–Ω–∏ –æ—Ç —Å–µ—Å–∏—è —Å Express?</h4>
						<pre class="highlight js">
							<code data-line-numbers="3">
app.get('/bar', function(req, res, next) {
	let someAttribute = req.session.someAttribute;
	res.send(`This will print the attribute I set earlier: ${someAttribute}`);
});																							  
							</code>
						</pre>
					</section>

					<section>
						<h4>–ö–∞–∫ –¥–∞ –Ω—É–ª–∏—Ä–∞–º–µ —Å–µ—Å–∏—è —Å Express?</h4>
						<pre class="highlight js">
							<code data-line-numbers="3">
app.get('/logout', function(req, res, next) {
	req.session.destroy((error) => {
		if (error) {
			console.error(error);
		}
	});
});																							  
							</code>
						</pre>
					</section>
				</section>

				<section>
					<h3>–ë–∏—Å–∫–≤–∏—Ç–∫–∏</h3>
					<section>
						<p class="fragment fade-in">M–∞–ª–∫–∞ —á–∞—Å—Ç –æ—Ç –¥–∞–Ω–Ω–∏, –∫–æ—è—Ç–æ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞ –≤ –±—Ä–∞—É–∑—ä—Ä–∞ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è. </p>
						<p class="fragment fade-in">–ù–∞—Ä–µ–¥–µ–Ω–∞ –¥–≤–æ–π–∫–∞ –∏–º–µ - —Å—Ç–æ–π–Ω–æ—Å—Ç.</p>
						<p class="fragment fade-in">–ò–º–∞—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∂–∏–≤–æ—Ç.</p>
					</section>
					<section>
						<figure>
							<img src="images/cookies.png"/>
						</figure>
					</section>
					<section>
						<figure>
							<img src="images/cookies-props.png"/>
						</figure>
					</section>
					<section>
						<h4>Cookies –≤ Express?</h4>
						<pre class="highlight js">
							<code data-line-numbers="3|7|11|12-13">
import * as express from 'express';
import * as cookieParser from 'cookie-parser';
	
const app = express();

app.use(cookieParser());

app.get('/', function (req, res) {
	const token = 'some token';
	console.log('Cookies: ', req.cookies);
	res.cookie('user', token, { maxAge: 60 * 60 * 24 * 30, httpOnly: true, secure: true });
	res.setHeader('Set-Cookie', `user=${token};`);
	res.send(token);
});
							</code>
						</pre>
					</section>
				</section>

				<section>
					<h3>–î—Ä—É–≥–∏ –Ω–∞—á–∏–Ω–∏ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Å–∏–∏</h3>

					<section>
						<ul>
							<li class="fragment fade-in">URL Rewriting</li>
							<li class="fragment fade-in">JSON Web Tokens (JWT)</li>
						</ul>
					</section>
				</section>

				<section>
					<div class="flow">
						<div class="step">üßë‚Äçüíª <strong>User</strong> ‚Üí <strong>Login</strong> ‚Üí üñ•Ô∏è <strong>Server</strong></div>
						<div class="arrow">‚¨áÔ∏è</div>
						<div class="step token">
						  <strong>Issued:</strong><br>
						  - accessToken (15m)<br>
						  - refreshToken (7d)
						</div>
					
						<div class="step">üßë‚Äçüíª <strong>User</strong> ‚Üí Request with <em>accessToken</em></div>
						<div class="step">üñ•Ô∏è <strong>Server</strong> ‚Üí Check JWT ‚Üí Check Blacklist ‚Üí ‚úÖ Proceed</div>
					
						<div class="step">üßë‚Äçüíª <strong>User</strong> ‚Üí <strong>Logout</strong></div>
						<div class="step">üñ•Ô∏è <strong>Server</strong> ‚Üí Add tokens to <strong>Blacklist</strong></div>
					
						<div class="step">üßë‚Äçüíª <strong>User</strong> ‚Üí Request with <strong>blacklisted token</strong></div>
						<div class="step">üñ•Ô∏è <strong>Server</strong> ‚Üí ‚ùå Reject</div>
					</div>
				</section>

				<section>
					<h3>–£–ø—ä–ª–Ω–æ–º–æ—â–∞–≤–∞–Ω–µ –∏ –£–¥–æ—Å—Ç–æ–≤–µ—Ä—è–≤–∞–Ω–µ</h3>

					<p class="fragment fade-in">–£–ø—ä–ª–Ω–æ–º–æ—â–∞–≤–∞–Ω–µ (authorization) - –ø—Ä–æ—Ü–µ—Å –Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è–Ω–µ –Ω–∞ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç –Ω–∞ –Ω—è–∫–æ–≥–æ –∑–∞ –¥–æ—Å—Ç—ä–ø –¥–æ –¥–∞–¥–µ–Ω —Ä–µ—Å—É—Ä—Å.</p>
					<p class="fragment fade-in">–£–¥–æ—Å—Ç–æ–≤–µ—Ä—è–≤–∞–Ω–µ (authentication) - –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª.</p>
				</section>

				<section>
					<h3>–ü–∞—Ä–æ–ª–∏</h3>

					<p>–ù–∏–∫–æ–≥–∞ –Ω–µ —Ç—Ä—è–±–≤–∞ –ø–∞—Ä–æ–ª–∏—Ç–µ –¥–∞ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞—Ç –≤ —á–∏—Å—Ç –≤–∏–¥, –∫–∞–∫—Ç–æ –≤ –º–æ–¥–µ–ª–∞ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ, —Ç–∞–∫–∞ –∏ –≤ —Å–∞–º–∞—Ç–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏.</p>
				</section>

				<section>
					<h3>–•–µ—à–∏—Ä–∞—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏</h3>

					<p>–ù–∞ –¥–∞–¥–µ–Ω –Ω–∏–∑ —Å—ä–ø–æ—Å—Ç–∞–≤—è—Ç –¥—Ä—É–≥ –Ω–∏–∑ —Å —Ñ–∏–∫—Å–∏—Ä–∞–Ω —Ä–∞–∑–º–µ—Ä.</p>
					<p class="fragment fade-in">–•–µ—à–∏—Ä–∞—â–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–∞—Ç –¥–≤–µ –≤–∞–∂–Ω–∏ —Å–≤–æ–π—Å—Ç–≤–∞:</p>
					<ul>
						<li class="fragment fade-in">–§—É–Ω–∫—Ü–∏—è—Ç–∞ –µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞.</li>
						<li class="fragment fade-in">–§—É–Ω–∫—Ü–∏—è—Ç–∞ –µ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–Ω–∞.</li>
					</ul>
				</section>

				<section>
					<h3>–•–µ—à–∏—Ä–∞–Ω–µ –Ω–∞ –ø–∞—Ä–æ–ª–∏ –≤ Express?</h3>
					<pre class="highlight js">
						<code data-line-numbers="2|4|5-6">
import * as bcrypt from 'bcrypt';

bcrypt.hash(user.password, 10, async (error: Error, hash: string) => {
	await User.create(
		{ username: user.username, password: hash, email: user.email }, 
		(error: Error, newUser: IUser) => {
			if (error) {
				console.error(error);
			}
		});
});
						</code>
					</pre>
				</section>

				<section>
					<h3>–ê–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è —Å Express?</h3>
					<pre class="highlight js">
						<code data-line-numbers="3|14-16">
import { Request, Response } from 'express';
import * as bcrypt from 'bcrypt';
import UserController from '../controllers/user-controller';

let controller = new UserController();

const auth = async (request: Request, response: Response, next: () => void) => {
	const { username, password } = request.body;

	const user = await controller.findUser(username);

	if (user) {
		bcrypt.compare(
			password, 
			user.password, 
			(error: Error, result: boolean) => {
				if (result) {
					next();
				} else {
					response.status(401).send('Unauthorized');
				}
			});
	}
}
						</code>
					</pre>
				</section>

				<section><h3>–í—ä–ø—Ä–æ—Å–∏?</h3></section>
			</div>
		</div>

		<script src="../../dist/reveal.js"></script>
		<script src="../../plugin/notes/notes.js"></script>
		<script src="../../plugin/markdown/markdown.js"></script>
		<script src="../../plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
